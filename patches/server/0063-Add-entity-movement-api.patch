From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Dueris MC <purplewolf.mc1@gmail.com>
Date: Fri, 17 Nov 2023 20:53:18 +0000
Subject: [PATCH] Add entity movement api


diff --git a/src/main/java/net/minecraft/world/entity/Entity.java b/src/main/java/net/minecraft/world/entity/Entity.java
index c2c160ac032a00e488d8735f1dfcb49cfa2cf583..f014f660db978c2d7fae4623218ed33c55095afa 100644
--- a/src/main/java/net/minecraft/world/entity/Entity.java
+++ b/src/main/java/net/minecraft/world/entity/Entity.java
@@ -820,7 +820,7 @@ public abstract class Entity implements Nameable, EntityAccess, CommandSource, S
         return this.dimensions.makeBoundingBox(this.position);
     }
 
-    protected void reapplyPosition() {
+    public void reapplyPosition() { // Canvas - protected -> public
         this.setPos(this.position.x, this.position.y, this.position.z);
     }
 
@@ -1651,7 +1651,7 @@ public abstract class Entity implements Nameable, EntityAccess, CommandSource, S
         }
     }
 
-    protected float nextStep() {
+    public float nextStep() { // Canvas - protected -> public
         return (float) ((int) this.moveDist + 1);
     }
 
diff --git a/src/main/java/net/minecraft/world/entity/animal/Turtle.java b/src/main/java/net/minecraft/world/entity/animal/Turtle.java
index 98922d10ea85b7e4818472d6da48c0e6424959da..b772847c2c52a1febdcf33bbd02db4acb7bc7f21 100644
--- a/src/main/java/net/minecraft/world/entity/animal/Turtle.java
+++ b/src/main/java/net/minecraft/world/entity/animal/Turtle.java
@@ -297,7 +297,7 @@ public class Turtle extends Animal {
     }
 
     @Override
-    protected float nextStep() {
+    public float nextStep() { // Canvas - protected -> public
         return this.moveDist + 0.15F;
     }
 
diff --git a/src/main/java/net/minecraft/world/entity/monster/Strider.java b/src/main/java/net/minecraft/world/entity/monster/Strider.java
index 1ea12e3fa05b3dbbef8e9daaeb114f2a433bf747..c0502deca7a929174ebfa0b2acf2aee1571ba4e6 100644
--- a/src/main/java/net/minecraft/world/entity/monster/Strider.java
+++ b/src/main/java/net/minecraft/world/entity/monster/Strider.java
@@ -352,7 +352,7 @@ public class Strider extends Animal implements ItemSteerable, Saddleable {
     }
 
     @Override
-    protected float nextStep() {
+    public float nextStep() { // Canvas - protected -> public
         return this.moveDist + 0.6F;
     }
 
diff --git a/src/main/java/net/minecraft/world/entity/monster/warden/Warden.java b/src/main/java/net/minecraft/world/entity/monster/warden/Warden.java
index e614d32a2f7b9b3a943c7a5642707aeb89b2a2f2..4609f75f651e11438d4c417741a5ab2644c733ce 100644
--- a/src/main/java/net/minecraft/world/entity/monster/warden/Warden.java
+++ b/src/main/java/net/minecraft/world/entity/monster/warden/Warden.java
@@ -207,7 +207,7 @@ public class Warden extends Monster implements VibrationSystem {
     // Canvas end
 
     @Override
-    protected float nextStep() {
+    public float nextStep() { // Canvas - protected -> public
         return this.moveDist + 0.55F;
     }
 
diff --git a/src/main/java/org/bukkit/craftbukkit/entity/CraftEntity.java b/src/main/java/org/bukkit/craftbukkit/entity/CraftEntity.java
index d2c4ebe74023c96220aae4629abb3a515f1c2a20..d77c51fda5a05ff68d99fb0810b84b3c3c00a653 100644
--- a/src/main/java/org/bukkit/craftbukkit/entity/CraftEntity.java
+++ b/src/main/java/org/bukkit/craftbukkit/entity/CraftEntity.java
@@ -25,6 +25,7 @@ import net.minecraft.world.entity.Interaction;
 import net.minecraft.world.entity.LightningBolt;
 import net.minecraft.world.entity.LivingEntity;
 import net.minecraft.world.entity.Marker;
+import net.minecraft.world.entity.MoverType;
 import net.minecraft.world.entity.PathfinderMob;
 import net.minecraft.world.entity.TamableAnimal;
 import net.minecraft.world.entity.ambient.AmbientCreature;
@@ -163,6 +164,8 @@ import net.minecraft.world.entity.vehicle.MinecartHopper;
 import net.minecraft.world.entity.vehicle.MinecartSpawner;
 import net.minecraft.world.entity.vehicle.MinecartTNT;
 import net.minecraft.world.phys.AABB;
+import net.minecraft.world.phys.Vec3;
+
 import org.bukkit.EntityEffect;
 import org.bukkit.Location;
 import org.bukkit.Registry;
@@ -502,6 +505,39 @@ public abstract class CraftEntity implements org.bukkit.entity.Entity {
     public Vector getVelocity() {
         return CraftVector.toBukkit(this.entity.getDeltaMovement());
     }
+    // Canvas start - movement api
+
+    @Override
+    public void step(){
+        this.step(1);
+    }
+
+    @Override
+    public void step(int steps){
+        for(int i = 0; i < steps; i++){
+            double x = this.getLocation().getDirection().getX();
+            double y = this.getLocation().getDirection().getY();
+            double z = this.getLocation().getDirection().getZ();
+
+            this.getHandle().move(MoverType.SELF, new Vec3(x, y, z));
+        }
+    }
+
+    @Override
+    public void setDeltaMovement(double x, double y, double z){
+        this.getHandle().setDeltaMovement(x, y, z);
+    }
+
+    @Override
+    public void reapplyPosition(){
+        this.getHandle().reapplyPosition();
+    }
+
+    @Override
+    public void turn(double cursorDeltaX, double cursorDeltaY){
+        this.getHandle().turn(cursorDeltaX, cursorDeltaY);
+    }
+    // Canvas end
 
     @Override
     public void setVelocity(Vector velocity) {
@@ -1234,6 +1270,13 @@ public abstract class CraftEntity implements org.bukkit.entity.Entity {
     public void setPortalCooldown(int cooldown) {
         this.getHandle().portalCooldown = cooldown;
     }
+    // Canvas - why not have "isInPortalCooldown?"
+
+    @Override
+    public boolean isInPortalCooldown(){
+        return this.getHandle().portalCooldown > 0;
+    }
+    // Canvas end
 
     @Override
     public Set<String> getScoreboardTags() {
