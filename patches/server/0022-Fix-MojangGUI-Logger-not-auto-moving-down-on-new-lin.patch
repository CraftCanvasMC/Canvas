From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: PurpleWolfMC <jedimastertoothless@hotmail.com>
Date: Sun, 22 Oct 2023 18:15:49 -0700
Subject: [PATCH] Fix MojangGUI Logger not auto moving down on new line print


diff --git a/src/main/java/net/minecraft/server/gui/MinecraftServerGui.java b/src/main/java/net/minecraft/server/gui/MinecraftServerGui.java
index e30c0bf5aba87396fbaa1d35a09a10099a6914a5..c2efc18713cba645fae657641f09b2211504c68e 100644
--- a/src/main/java/net/minecraft/server/gui/MinecraftServerGui.java
+++ b/src/main/java/net/minecraft/server/gui/MinecraftServerGui.java
@@ -280,28 +280,30 @@ public class MinecraftServerGui extends CraftServerGui implements MojangServerGu
     }
 
     private static final java.util.regex.Pattern ANSI = java.util.regex.Pattern.compile("\\e\\[[\\d;]*[^\\d;]"); // CraftBukkit // Paper
-    public void print(org.purpurmc.purpur.gui.JColorTextPane textArea, JScrollPane scrollPane, String message) { // Purpur
+    public void print(org.purpurmc.purpur.gui.JColorTextPane textArea, JScrollPane scrollPane, String message) {
         Document document = textArea.getDocument();
         JScrollBar jscrollbar = scrollPane.getVerticalScrollBar();
-        boolean flag = false;
 
         if (scrollPane.getViewport().getView() == textArea) {
-            flag = (double) jscrollbar.getValue() + jscrollbar.getSize().getHeight() + (double) (MinecraftServerGui.FONT.getSize() * 4) > (double) jscrollbar.getMaximum(); // Canvas
+            boolean atBottom = (double) jscrollbar.getValue() + jscrollbar.getSize().getHeight() + (double) (MinecraftServerGui.FONT.getSize() * 4) > (double) jscrollbar.getMaximum();
+
+        /* // Purpur
+        try {
+            document.insertString(document.getLength(), MinecraftServerGui.ANSI.matcher(message).replaceAll(""), (AttributeSet) null); // CraftBukkit
+        } catch (BadLocationException badlocationexception) {
+            ;
         }
-            /* // Purpur
-            try {
-                document.insertString(document.getLength(), MinecraftServerGui.ANSI.matcher(message).replaceAll(""), (AttributeSet) null); // CraftBukkit
-            } catch (BadLocationException badlocationexception) {
-                ;
-            }
-            */ // Purpur
-        textArea.append(message+ "\n"); // Purpur // Canvas
+        */ // Purpur
+            textArea.append(message.replaceAll("\u001B\\[[;\\d]*m", "") + "\n"); // Purpur // Canvas
 
-        if (flag) {
-            jscrollbar.setValue(Integer.MAX_VALUE);
+            if (atBottom) {
+                textArea.setCaretPosition(textArea.getDocument().getLength());
+                jscrollbar.setValue(Integer.MAX_VALUE);
+            }
         }
     }
 
+
     private static int max = 1000; // Canvas
 
     // Purpur start
